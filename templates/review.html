<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FindDoctor</title>
  <link rel="stylesheet" href="template.css">
  <script src="https://kit.fontawesome.com/37fb3b3f95.js" crossorigin="anonymous"></script>
</head>

<body>

  <div class="nav">
    <a class="logo" href="/">FindDoctor</a>
    <div class="keyword">
      <input class="doctor" placeholder="請輸入醫生名稱">
      <input class="department" placeholder="科別">
      <i class="fas fa-search"></i>
    </div>
  </div>

  <div class="tab">
    <div class="category">
      <a class="category-text thank" href="" style="color:white;">臺北榮總感謝函</a>
    </div>
    <div class="category">
      <a class="category-text search" href="" style="color:white;">感謝</a>
    </div>
    <div class="category">
      <a class="category-text Ptt" href="" style="color:white;">Ptt</a>
    </div>
    <div class="category">
      <a class="category-text blog" href="" style="color:white;">部落格</a>
    </div>
    <div class="category active">
      <a class="category-text review" href="" style="color:rgb(137, 207, 240);">Google評論</a>
    </div>
    <div class="category">
      <a class="category-text business" href="" style="color:white;">良醫健康網</a>
    </div>
    <div class="category">
      <a class="category-text judgment" href="" style="color:white;">司法院判決書</a>
    </div>
  </div>
  <hr>


  <div class="content-container">
    <div class="content" style="color:yellow;">資料讀取中，請稍後</div>
  </div>

</body>

<script>

  function getReview() {
    function starImg(starcounts) {
      starcounts = Number(starcounts)
      let star = "";
      for (i = 0; i < starcounts; i++) {
        star = star + `<img class="star" src="/star.png" width="15" height="15">`;
      }
      return star
    }

    const inputtext = decodeURIComponent(window.location.search).replace("?search=", "");
    const keyword = inputtext.split()[0];
    const search = document.querySelector(".doctor");
    search.value = inputtext;
    const contentContainer = document.querySelector(".content-container");
    url = "/api/review/" + inputtext; //

    fetch(url, { method: "GET" })
      .then(response => response.json())
      .then(result => {
        contentContainer.innerHTML = `<div class="from">資料來源：Google評論@${result["title"]}</div>`;
        const data = result["data"]

        data.forEach(d => {
          const content = document.createElement("div");
          content.classList.add("content");

          title = d["name"].replace(keyword, `<span class="highlight">${keyword}</span>`)
          text = d["comment"].replace(keyword, `<span class="highlight">${keyword}</span>`)

          star = starImg(d["star"])
          content.innerHTML = `
            <a href="${d["link"]}" target="_blank"><span class="content-title">${star}  ${d["when"]}</span>
            <span class="content-name">@${title}</span></a>
            <div class="content-text">${text}</div>`
          contentContainer.appendChild(content);
        })
      })
      .catch(error => console.error("Error:", error))
  }

  getReview();

  const submit = document.querySelector(".fas")
  submit.addEventListener("click", function (event) {
    const search = document.querySelector(".doctor").value
    return window.location.href = "/review?search=" + search
  })

  document.querySelector(".thank").href = "/thank?search=" + document.querySelector(".doctor").value
  document.querySelector(".search").href = "/search?search=" + document.querySelector(".doctor").value
  document.querySelector(".Ptt").href = "/Ptt?search=" + document.querySelector(".doctor").value
  document.querySelector(".blog").href = "/blog?search=" + document.querySelector(".doctor").value
  document.querySelector(".judgment").href = "/judgment?search=" + document.querySelector(".doctor").value
  document.querySelector(".review").href = "/review?search=" + document.querySelector(".doctor").value
  document.querySelector(".business").href = "/business?search=" + document.querySelector(".doctor").value
</script>

</html>